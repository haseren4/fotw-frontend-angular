<div class="container py-3">
  <div *ngIf="loading" class="alert alert-info">Loading sites…</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- Map -->
  <div *ngIf="!loading && !error" class="map-container mb-3">
    <div class="world-map">
      <ng-container *ngFor="let s of sites">
        <div class="pin"
             [style.left]="toLeftPercent(s.longitude)"
             [style.top]="toTopPercent(s.latitude)"
             tabindex="0"
             (mouseenter)="onHover(s)"
             (mouseleave)="onHover(null)"
             (focusin)="onHover(s)"
             (focusout)="onHover(null)"
             (click)="onClick(s)">
          <div class="dot" [class.active]="s.active"></div>
        </div>
      </ng-container>

      <!-- Bottom-of-map tooltip -->
      <div class="map-tooltip-bottom" *ngIf="hoveredSite as hs">
        <div class="title">Site #{{ hs.id }}</div>
        <div class="line" *ngIf="hs.location || hs.qth">{{ hs.location }}<span *ngIf="hs.location && hs.qth"> • </span>{{ hs.qth }}</div>
        <div class="line" *ngIf="hs.category">Category: {{ hs.category }}</div>
        <div class="line coords" *ngIf="hs.latitude != null && hs.longitude != null">{{ hs.latitude }}, {{ hs.longitude }}</div>
      </div>
    </div>
  </div>

  <!-- Locations list below the map -->
  <div *ngIf="!loading && !error" class="sites-list">
    <h5 class="mb-2">Site Locations</h5>
    <div class="row g-2">
      <div class="col-12 col-sm-6 col-lg-4" *ngFor="let s of sites">
        <div class="site-card p-2 h-100 border rounded">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="fw-semibold">Site #{{ s.id }}</div>
              <div class="small text-offwhite" *ngIf="s.location || s.qth">
                {{ s.location }}<span *ngIf="s.location && s.qth"> • </span>{{ s.qth }}
              </div>
              <div class="small" *ngIf="s.latitude != null && s.longitude != null">
                {{ s.latitude }}, {{ s.longitude }}
              </div>
            </div>
            <span class="badge bg-secondary" *ngIf="s.category">{{ s.category | underscoreToSpace | titlecase }}</span>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="!sites?.length" class="text-muted">No sites to display.</div>
  </div>
</div>
