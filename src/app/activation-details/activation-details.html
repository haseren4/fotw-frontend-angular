<div class="container py-4">
  <a routerLink="/past-activations" class="btn btn-outline-secondary btn-sm mb-3">← Back to Past Activations</a>

  <h1 class="mb-2">Activation Details</h1>
  <p class="text-offwhite mb-3">Merged timeline of contacts and posts.</p>

  <div *ngIf="error" class="alert alert-warning">{{ error }}</div>

  <div class="card bg-offwhite text-on-fota-slate-soft mb-3" *ngIf="activation as a">
    <div class="card-body">
      <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
        <div>
          <div class="fw-bold">
            <img [src]="(a.status || 'completed') | statusIcon" [alt]="a.status" style="height:22px; vertical-align:middle;" />
            {{ a.title || ('Activation #' + a.id) }}
          </div>
          <div class="text-muted small">Site: <span class="badge rounded-pill bg-secondary">#{{ a.siteId }}</span></div>
        </div>
        <div class="text-end small">
          <div><strong>Started:</strong> {{ a.startedAt | date:'medium' }}</div>
          <div><strong>Ended:</strong> {{ a.endedAt | date:'medium' }}</div>

        </div>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="alert alert-info">Loading timeline…</div>
  <div *ngIf="!loading && timeline.length === 0" class="alert alert-secondary">No posts or contacts for this activation.</div>

  <div class="list-group">
    <div *ngFor="let item of timeline; trackBy: trackByTimeline"
         class="list-group-item mb-2"
         [ngClass]="{
           'bg-light border-success': item.kind === 'contact',
           'bg-offwhite border-primary': item.kind === 'post'
         }"
         style="border-width:2px;">

      <!-- Contact row theme -->
      <ng-container *ngIf="item.kind === 'contact'">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
          <div>
            <span class="badge bg-success me-2">Contact</span>
            <span class="fw-bold">{{ item.contact.callsign?.toUpperCase() || 'Unknown' }}</span>
            <span class="text-muted small ms-2" *ngIf="item.contact.band || item.contact.mode">
              {{ item.contact.band || '' }}<span *ngIf="item.contact.band && item.contact.mode"> · </span>{{ item.contact.mode || '' }}
            </span>
          </div>
          <div class="text-end small">
            <div><strong>Time:</strong> {{ item.ts | date:'medium' }}</div>
            <div class="text-muted" *ngIf="item.contact.rstSent || item.contact.rstRcvd">
              RST: {{ item.contact.rstSent || '-' }}/{{ item.contact.rstRcvd || '-' }}
            </div>
          </div>
        </div>
        <div class="mt-2 text-muted" *ngIf="item.contact.notes">{{ item.contact.notes }}</div>
      </ng-container>

      <!-- Post row theme -->
      <ng-container *ngIf="item.kind === 'post'">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
          <div>
            <span class="badge bg-primary me-2">Post</span>
            <span class="fw-bold">{{ item.post.author?.toUpperCase() || 'Update' }}</span>
          </div>
          <div class="text-end small">
            <div><strong>Time:</strong> {{ item.ts | date:'medium' }}</div>
          </div>
        </div>
        <div class="mt-2">{{ item.post.content }}</div>
      </ng-container>

    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <a routerLink="/past-activations" class="btn btn-outline-secondary btn-sm">Back to Past Activations</a>
    <a *ngIf="activation" [routerLink]="['/activations', activation.id, 'contacts']" class="btn btn-outline-primary btn-sm">Contacts only</a>
  </div>
</div>
